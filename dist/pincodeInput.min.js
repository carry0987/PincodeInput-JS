!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?t(exports):"function"==typeof define&&define.amd?define(["exports"],t):t((e="undefined"!=typeof globalThis?globalThis:e||self).pincodeInputjs={})}(this,function(e){"use strict";const t={autoFocus:!1,allowEscape:!0,allowPaste:!0,secure:!1,placeHolder:"â€¢",forceDigits:!0,enableNavigation:!0,length:6,styles:{},onLoad:()=>{},onInput:(e,t)=>{},onComplete:e=>{}};var n=Object.freeze({__proto__:null,reportError:function(...e){console.error(...e)},throwError:function(e){throw new Error(e)}});function i(e,t,n){if("string"!=typeof e)return e;let i=document;return null===t&&n?i=n:t&&t instanceof Node&&"querySelector"in t?i=t:n&&n instanceof Node&&"querySelector"in n&&(i=n),"all"===t?i.querySelectorAll(e):i.querySelector(e)}function s(e,t={},n=""){let i=document.createElement(e);for(let e in t)Object.prototype.hasOwnProperty.call(t,e)&&("textContent"===e||"innerText"===e?i.textContent=t[e]:i.setAttribute(e,t[e]));return n&&(i.textContent=n),i}function o(e,t){return e.classList.add(t),e}function l(e,t){return e.classList.remove(t),e}function a(e,t,n){return e.classList.toggle(t,n),e}let r="utils-style";const c={from:".utils",to:".utils-"};function d(e){return"object"==typeof e&&null!==e&&!h(e)}function h(e){return Array.isArray(e)}function u(e){return"number"!=typeof e&&("string"==typeof e&&0===e.length||(!(!h(e)||0!==e.length)||(!(!d(e)||0!==Object.keys(e).length)||!e)))}function p(e,...t){if(!t.length)return e;const n=t.shift();if(n)for(const t in n)if(Object.prototype.hasOwnProperty.call(n,t)){const i=n[t],s=t;d(i)||h(i)?(e[s]&&"object"==typeof e[s]||(e[s]=h(i)?[]:{}),p(e[s],i)):e[s]=i}return p(e,...t)}function m(e){r=e}function v(e,t){c.from=e,c.to=t}function f(e,t=null){t=u(t)?"":t;let n=s("style");n.id=r+t,n.textContent="",document.head.append(n);let i=n.sheet;for(let n in e)e.hasOwnProperty(n)&&C(i,n,g(e[n]),t)}function g(e){let t="";for(let[n,i]of Object.entries(e))n=n.replace(/([A-Z])/g,e=>`-${e[0].toLowerCase()}`),t+=`${n}:${i};`;return t}function C(e,t,n,i=null){i=u(i)?"":i;let s=t.replace(c.from,c.to+i);e.insertRule(s+"{"+n+"}",0)}function y(e=null){const t=u(e)?"":e;let n=i("#"+r+t);n&&n.parentNode&&n.parentNode.removeChild(n)}function b(e,t,n,i){e.addEventListener(t,n,i)}class E{static pinHideTimeoutMap=new WeakMap;static throwError=n.throwError;static deepMerge=p;static setStylesheetId=m;static setReplaceRule=v;static injectStylesheet=f;static removeStylesheet=y;static getElem=i;static createElem=s;static addClass=o;static removeClass=l;static toggleClass=a;static addEventListener=b;static isDigit(e){return/^\d$/.test(e)}static updateVisiblePinCode(e,t,n,i,s){const o=e.value,l=E.getElem(".pincode-grid span","all");if(!i)return l.forEach((e,t)=>{"number"==typeof s?t!==s||o[t]?e.textContent=o[t]||"":e.textContent="":e.textContent=o[t]||""}),t?.(o,s??o.length-1),o.length===e.maxLength&&n?.(o),void E.clearTimeout(e);if(E.clearTimeout(e),l.forEach((e,t)=>{t===o.length-1?e.textContent=o[t]||"":e.textContent=o[t]?i:""}),t?.(o,e.selectionStart??o.length-1),o.length>0){const t=window.setTimeout(()=>{e.value===o&&l.forEach((e,t)=>{e.textContent=o[t]?i:""}),E.pinHideTimeoutMap.delete(e)},500);E.pinHideTimeoutMap.set(e,t)}o.length===e.maxLength&&n?.(o)}static clearTimeout(e){E.pinHideTimeoutMap.has(e)&&(clearTimeout(E.pinHideTimeoutMap.get(e)),E.pinHideTimeoutMap.delete(e))}}E.setStylesheetId("pincodeInput-style"),E.setReplaceRule(".pincodeInput",".pincodeInput");class x{static instances=[];static version="1.2.0";element;options=t;activeGridIndex=0;onInputCallback=void 0;onCompleteCallback=void 0;constructor(e,t={}){this.init(e,t),x.instances.push(this),1===x.instances.length&&((e,t=!1)=>{!0===t?console.log("Data Type : "+typeof e,"\nValue : "+e):"boolean"!=typeof t?console.log(t):console.log(e)})(`PincodeInput is loaded, version: ${x.version}`)}init(e,n){let i;i="string"==typeof e?E.getElem(e):e,i||E.throwError("Element not found"),i instanceof HTMLInputElement||E.throwError("Element must be an input field"),this.element=i,this.options=E.deepMerge({},t,n),this.onInputCallback=n.onInput,this.onCompleteCallback=n.onComplete,this.options?.onLoad?.(),this.createPincodeGrids(x.instances.length)}createPincodeGrids(e){const t=this.options,n=this.element.maxLength>0?this.element.maxLength:t.length;let i={};t.styles&&Object.keys(t.styles).length>0&&(i=E.deepMerge({},t.styles,i)),i&&E.injectStylesheet(i,e.toString());const s=E.createElem("div");s.className="pincodeInput";const o=E.createElem("div");o.className="pincode";for(let e=0;e<n;e++){const t=E.createElem("div"),n=E.createElem("span");t.className="pincode-grid",t.dataset.index=e.toString(),t.appendChild(n),o.appendChild(t)}const l=this.element.parentElement,a=this.element.nextSibling;return l&&(l.removeChild(this.element),a?l.insertBefore(s,a):l.appendChild(s)),E.addClass(this.element,"pincode-input"),this.element.removeAttribute("hidden"),this.element.type=t.secure?"password":"text",this.element.pattern="[0-9]*",this.element.inputMode="numeric",this.element.maxLength=n,this.element.autocomplete="off",s.appendChild(this.element),s.appendChild(o),E.getElem(".pincode-grid","all",s).forEach(e=>{E.addEventListener(e,"click",()=>this.element.focus())}),E.addEventListener(this.element,"input",this.onPinInput.bind(this)),E.addEventListener(this.element,"keydown",this.handleKeydown.bind(this)),E.addEventListener(this.element,"paste",this.handlePaste.bind(this)),E.addEventListener(this.element,"focus",()=>this.updateFocus()),E.addEventListener(this.element,"blur",this.removeFocus.bind(this),!0),t.autoFocus&&this.setActiveGrid(0),this}setActiveGrid(e){this.activeGridIndex=e,this.element.focus(),this.element.setSelectionRange(e,e),this.updateFocus()}updateFocus(){const e=Array.from(E.getElem(".pincode-grid","all")),t=this.element.value.length;this.options.enableNavigation&&!this.options.secure||(this.activeGridIndex=t),e.forEach((e,t)=>{t===this.activeGridIndex?E.addClass(e,"pincode-focus"):E.removeClass(e,"pincode-focus")}),this.element.focus()}removeFocus(){E.getElem(".pincode-grid","all").forEach(e=>{E.removeClass(e,"pincode-focus")})}onPinInput(e){const t=e.target;this.options.forceDigits&&t.value&&(t.value=t.value.replace(/\D/g,"")),this.options.enableNavigation&&!this.options.secure?this.activeGridIndex=t.selectionStart??t.value.length:this.activeGridIndex=t.value.length;const n=this.options.secure?this.options.placeHolder:void 0;t.value.length<=t.maxLength?(E.updateVisiblePinCode(t,this.onInputCallback,this.onCompleteCallback,n,this.activeGridIndex),this.updateFocus()):t.value=t.value.slice(0,t.maxLength)}handleKeydown(e){const t=(e.ctrlKey||e.metaKey)&&"v"===e.key;if(!t){if(this.options.enableNavigation&&!this.options.secure){const{maxLength:t}=this.element;switch(e.key){case"ArrowLeft":return this.activeGridIndex>0&&this.setActiveGrid(this.activeGridIndex-1),void e.preventDefault();case"ArrowRight":return this.activeGridIndex<t-1&&this.setActiveGrid(this.activeGridIndex+1),void e.preventDefault();case"ArrowUp":return this.setActiveGrid(0),void e.preventDefault();case"ArrowDown":return this.setActiveGrid(t-1),void e.preventDefault();case"Backspace":if(this.activeGridIndex>0){const e=this.element.value.split("");e.splice(this.activeGridIndex,1),this.element.value=e.join(""),this.setActiveGrid(this.activeGridIndex-1),E.updateVisiblePinCode(this.element,this.onInputCallback,this.onCompleteCallback,void 0,this.activeGridIndex+1),this.updateFocus()}else this.handleBackspace();return void e.preventDefault();case"Escape":return void(this.options.allowEscape&&this.handleEscape())}return}if("Backspace"===e.key)return this.handleBackspace(),void e.preventDefault();"Escape"===e.key&&this.options.allowEscape?this.handleEscape():this.options.forceDigits&&!t&&(E.isDigit(e.key)||e.preventDefault())}}handleBackspace(){const e=this.element.value,t=this.options.secure?this.options.placeHolder:void 0;0!==e.length&&(this.element.value=e.slice(0,e.length-1),E.updateVisiblePinCode(this.element,this.onInputCallback,this.onCompleteCallback,t),this.updateFocus())}handleEscape(){this.clear(),this.element.blur()}handlePaste(e){if(!this.options.allowPaste)return void e.preventDefault();const t=e.clipboardData;if(!t)return;const n=t.getData("text").slice(0,this.element.maxLength);this.options.forceDigits?this.element.value=n.replace(/\D/g,""):this.element.value=n,E.updateVisiblePinCode(this.element,this.onInputCallback,this.onCompleteCallback,this.options.secure?this.options.placeHolder:void 0),this.activeGridIndex=this.element.value.length,this.updateFocus(),e.preventDefault()}clear(){this.element.value="",this.activeGridIndex=0,this.element.dispatchEvent(new Event("input")),E.clearTimeout(this.element)}destroy(){let e=x.instances.indexOf(this);e<0?E.throwError("PincodeInput instance not found"):(E.removeStylesheet(e.toString()),this.element.remove(),x.instances.splice(e,1))}set onInput(e){this.onInputCallback=e}set onComplete(e){this.onCompleteCallback=e}get value(){return this.element.value}}var I=Object.freeze({__proto__:null});e.PincodeInput=x,e.PincodeInputInterface=I});
